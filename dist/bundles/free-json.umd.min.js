!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/forms"),require("@angular/common"),require("drag-enabled")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/forms","@angular/common","drag-enabled"],n):n(e["free-json"]={},e.ng.core,e.ng.forms,e.ng.common,e.dragEnabled)}(this,function(e,n,t,r,o){"use strict";function a(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||0<n--)&&!(r=a.next()).done;)i.push(r.value)}catch(d){o={error:d}}finally{try{r&&!r.done&&(t=a["return"])&&t.call(a)}finally{if(o)throw o.error}}return i}function i(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(a(arguments[n]));return e}var l={literal:1,pair:2,json:3,array:4};l[l.literal]="literal",l[l.pair]="pair",l[l.json]="json",l[l.array]="array";var d={add:1,remove:2,move:3,modified:4};d[d.add]="add",d[d.remove]="remove",d[d.move]="move",d[d.modified]="modified";var c=function(){function e(){}return e.prototype.generateNodeId=function(){return Math.floor(1e4*Math.random())+1},e.prototype.getFilteredText=function(){return this.filteredText},e.prototype.getNewNode=function(e){return{id:this.generateNodeId(),name:"name",value:"value",parent:e.type,parentNode:e,type:l.literal,children:[],expanded:!1}},e.prototype.setFilteredText=function(e){this.filteredText=e},e}();c.decorators=[{type:n.Injectable}],c.ctorParameters=function(){return[]};var s=function(){function e(e){this.manager=e,this.reasoningCodes=[],this.onpublish=new n.EventEmitter,this.onchange=new n.EventEmitter}return Object.defineProperty(e.prototype,"root",{get:function(){return this.children},set:function(e){if(e){this.children=e,this.reasoning&&(this.reasoning=[]);var n={id:this.manager.generateNodeId(),name:"Root",value:"Object",parent:l.array,type:l.array,expanded:!0,children:undefined,isRoot:!0};n.children=this.transformNodeToInternalStruction(this.children,n),this.transformedData=[n]}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"save",{get:function(){return!1},set:function(e){if(e){var n=this.transformedInternalStructureBackToNode(this.transformedData[0].children,l.json);this.onpublish.emit(n)}},enumerable:!0,configurable:!0}),e.prototype.transformedInternalStructureBackToNode=function(e,n){var t=this,r={},o=[];return e.map(function(e){n===l.json?e.type===l.literal?o.push(e.value):e.type===l.pair?r[e.name]=e.value:e.type===l.array?r[e.name]=t.transformedInternalStructureBackToNode(e.children,e.parent):e.type===l.json&&(r[e.name]=t.transformedInternalStructureBackToNode(e.children,e.parent)):n===l.array&&(e.type===l.literal?o.push(e.value):e.type===l.json?o.push(t.transformedInternalStructureBackToNode(e,e.parent)):e.type===l.array&&o.push(t.transformedInternalStructureBackToNode(e.children,e.parent)))}),o.length?o:r},e.prototype.transformNodeToInternalStruction=function(r,o){var a=this,e=r;if(r instanceof Array){var i=[];r.map(function(e){var n={id:a.manager.generateNodeId(),name:"",value:"",parent:l.array,parentNode:o,type:l.array,children:[]},t=a.transformNodeToInternalStruction(e,n);t instanceof Array?n.children=t:(n.value=t,n.type=l.literal),i.push(n)}),e=i}else if(r instanceof Object){var n=Object.keys(r),d=[];n.map(function(e){var n={id:a.manager.generateNodeId(),name:e,value:"",parent:l.json,parentNode:o,type:l.array,children:[]},t=a.transformNodeToInternalStruction(r[e],n);t instanceof Array?n.children=t:(n.value=t,n.type=l.pair),d.push(n)}),e=d}return e},e.prototype.ngOnInit=function(){},e.prototype.addNewNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(n.children=i(n.children,[this.manager.getNewNode(n)]),n.expanded=!0,this.changePerformed({}))},e.prototype.moveNode=function(e,n,t){if(e.stopPropagation(),e.preventDefault(),this.reasoning);else{var r=this.transformedData.indexOf(n),o=t?0<r?r-1:r:r<this.transformedData.length-1?r+1:r;this.transformedData.splice(o,0,this.transformedData.splice(r,1)[0]),this.changePerformed({})}},e.prototype.deleteNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(this.transformedData.splice(this.transformedData.indexOf(n),1),this.changePerformed({}))},e.prototype.hasChevronDown=function(e){return e&&e.children&&0<e.children.length&&e.expanded},e.prototype.hasChevronRight=function(e){return e&&e.children&&0!=e.children.length&&!e.expanded},e.prototype.dragEnabled=function(e){return!e.medium.isRoot&&(e.medium.name.length||e.medium.value.length)},e.prototype.dropEnabled=function(e){return!e.destination.medium.isRoot},e.prototype.onDragStart=function(e){},e.prototype.onDragEnd=function(e){if(e.destination&&e.source.medium!==e.destination.medium){var n=this.transformedData.indexOf(e.source.medium);this.reasoning?console.log("adsadas"):(this.transformedData.splice(n,1),this.changePerformed({}))}},e.prototype.onDrop=function(e){if(e.destination&&e.source&&e.source.medium!==e.destination.medium){var n=e.source.medium,t=e.destination.medium;t.children=i(t.children,[n]),t.children.length&&(t.expanded=!0),t.type===l.literal?(t.type=l.json,t.value=""):t.type===l.pair?t.type=l.json:t.type===l.array&&t.parent===l.array&&n.type===l.pair&&(n.type=l.json),n.parent=t.type;var r=n.parentNode.children.indexOf(n);n.parentNode.children.splice(r,1),n.parentNode=t,this.changePerformed({})}},e.prototype.toGrandParent=function(e,n){e.stopPropagation(),e.preventDefault();var t=n.parentNode,r=n.parentNode.parentNode,o=t.children.indexOf(n),a=r.children.indexOf(t);t.children.splice(o,1),0===t.children.length?t.name.length||t.value.length?(t.type=l.pair,r.children.splice(a+1,0,n)):(r.children.splice(a,1),r.children.splice(a,0,n)):r.children.splice(a+1,0,n),n.parentNode=r,this.changePerformed({})},e.prototype.getFilteredText=function(){this.manager.getFilteredText()},e.prototype.toggle=function(e,n){e.stopPropagation(),e.preventDefault(),n.expanded=!n.expanded},e.prototype.keydown=function(e,n){var t=e.which;13!==t&&32!==t||this.toggle(e,n)},e.prototype.keymove=function(e,n,t){var r=e.which;13!==r&&32!==r||this.moveNode(e,n,t)},e.prototype.keydelete=function(e,n){var t=e.which;13!==t&&32!==t||this.deleteNode(e,n)},e.prototype.keytoGrandParent=function(e,n){var t=e.which;13!==t&&32!==t||this.toGrandParent(e,n)},e.prototype.keyadd=function(e,n){var t=e.which;13!==t&&32!==t||this.addNewNode(e,n)},e.prototype.canAddNode=function(e){return e.type===l.json||e.type===l.array},e.prototype.changePerformed=function(e){if(this.children){var n=this.transformedInternalStructureBackToNode(this.transformedData[0].children,l.json);this.onchange.emit({data:n,reasoning:this.reasoning})}else this.onchange.emit({})},e}();s.decorators=[{type:n.Component,args:[{selector:"free-json",template:'<ul>\n  <li  *ngFor="let child of transformedData | nodeSearch"\n        [dragEnabled]="dragEnabled.bind(this)"\n        [medium]="child"\n        (onDragEnd)=\'onDragEnd($event)\'\n        (onDragStart)=\'onDragStart($event)\'>\n    <div [dropEnabled]="dropEnabled.bind(this)"\n        class=\'tree-node\'\n        [id] = "child.id"\n        [medium]="child"\n        [class.move]="!child.isRoot && (child.name.length || child.value.length)"\n        (click)="toggle($event, child)"\n        (onDrop)=\'onDrop($event)\'>\n      <i  class=\'clickable fa fa-chevron-down\'\n          tabindex="0"\n          title="Collapse {{child.name}}"\n          *ngIf=\'hasChevronDown(child)\'\n          (keydown)=\'keydown($event, child)\'\n          (click)=\'toggle($event, child)\'></i>\n      <i  class=\'clickable fa fa-chevron-right\'\n          tabindex="0"\n          title="Expand {{child.name}}"\n          *ngIf=\'hasChevronRight(child)\'\n          (keydown)=\'keydown($event, child)\'\n          (click)=\'toggle($event, child)\'></i>\n      <i  class=\'fa fa-quote-right\'\n          arria-hidden="true"\n          *ngIf=\'child.type === 1\'></i>\n          <i  class=\'fa fa-random\'\n          arria-hidden="true"\n          *ngIf=\'child.type === 2\'></i>\n      <i  class=\'fa no-action fa-chevron-right\'\n          arria-hidden="true"\n          *ngIf=\'child.type === 4 && child.children.length == 0\'></i>\n      <json-label\n            (onchange)="changePerformed($event)"\n            [node]="child"></json-label>\n      <span class="edit-actions">\n      <i *ngIf="!child.isRoot"\n          class="clickable fa pull-right fa-times"\n          tabindex="0"\n          title="Delete {{child.name}}"\n          (click)=\'deleteNode($event, child)\'\n          (keydown)=\'keydelete($event, child)\'></i>\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\n          class="clickable fa pull-right fa-angle-double-up"\n          tabindex="0"\n          title="Move up {{child.name}}"\n          (click)=\'moveNode($event, child, true)\'\n          (keydown)=\'keymove($event, child, true)\'></i>\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\n          class="clickable fa pull-right fa-angle-double-down"\n          tabindex="0"\n          title="Move down {{child.name}}"\n          (click)=\'moveNode($event, child, false)\'\n          (keydown)=\'keymove($event, child, false)\'></i>\n      <i *ngIf="canAddNode(child)"\n          class="clickable fa pull-right fa-plus"\n          tabindex="0"\n          title="Add New Child"\n          (keydown)=\'keyadd($event, child)\'\n          (click)=\'addNewNode($event, child)\'></i>\n      <i *ngIf="!child.isRoot && child.parentNode.parentNode && (child.name.length || child.value.length)"\n          class="clickable fa pull-right fa-angle-double-left"\n          tabindex="0"\n          title="Move to {{child.parentNode.parentNode.name}}"\n          (click)=\'toGrandParent($event, child)\'\n          (keydown)=\'keytoGrandParent($event, child)\'></i>\n      </span>\n    </div>\n    <div *ngIf="child.expanded">\n      <free-json\n            (onchange)="changePerformed($event)"\n            [reasoning]="reasoning"\n            [reasoningCodes]="reasoningCodes"\n            [transformedData]=\'child.children\'></free-json>\n    </div>\n  </li>\n</ul>\n',styles:["ul{list-style:none;min-width:400px}.tree-node{padding:0;border:1px solid #eef1f4;background:#f7f9ff;color:#7c9eb2;margin:3px 0;text-transform:capitalize;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.tree-node i{width:15px;height:15px;margin:10px 3px}.tree-node.move{cursor:move}.clickable{cursor:pointer}.no-action{color:transparent}.edit-actions{border-left:1px solid #eef1f4;float:right}.drag-over{background-color:#7c9eb2;color:#fff}.fa{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fa-plus-square{color:green}.fa-minus-circle{color:red}"]}]}],s.ctorParameters=function(){return[{type:c}]},s.propDecorators={transformedData:[{type:n.Input,args:["transformedData"]}],reasoning:[{type:n.Input,args:["reasoning"]}],reasoningCodes:[{type:n.Input,args:["reasoningCodes"]}],root:[{type:n.Input}],save:[{type:n.Input}],onpublish:[{type:n.Output,args:["onpublish"]}],onchange:[{type:n.Output,args:["onchange"]}]};var p=function(){function e(e){this.manager=e}return e.prototype.filter=function(e){this.manager.setFilteredText(e)},e}();p.decorators=[{type:n.Component,args:[{selector:"json-search-field",template:"<input type='text' [(ngModel)]='val' (ngModelChange)='filter(val)'>"}]}],p.ctorParameters=function(){return[{type:c}]};var u=function(){function e(e){this.renderer=e,this.editName=!1,this.editValue=!1,this.onchange=new n.EventEmitter}return e.prototype.nameLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout(function(){n.nameEditor&&n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")},66)):27===t&&(this.editName=!1)},e.prototype.valueLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout(function(){n.valueEditor&&n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")},66)):27===t&&(this.editValue=!1)},e.prototype.clickName=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editName="Root"!==this.node.name,setTimeout(function(){n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")},66)},e.prototype.clickValue=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editValue="Object"!==this.node.value,setTimeout(function(){n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")},66)},e}();u.decorators=[{type:n.Component,args:[{selector:"json-label",template:"<span *ngIf=\"editName && node.name !=='Root' && node.value !=='Object'\">\n    <input #nameEditor\n        type='text'\n        id=\"editName\"\n        placeholder=\"Name\"\n        (blur)=\"editName = false; onchange.emit();\"\n        [(ngModel)]='node.name'>\n</span>\n<span *ngIf='!editName && node.type !== 1'\n    class='locked name'\n    tabindex='0'\n    (keydown)='nameLabelKeydown($event)'\n    (click)=\"clickName($event)\"\n    [innerHTML]=\"node.name.length ? node.name : '&nbsp;'\">\n</span>\n<span *ngIf=\"editValue && node.name !=='Root' && node.value !=='Object'\">\n    <input #valueEditor\n        type='text'\n        id=\"editValue\"\n        placeholder=\"Value\"\n        (blur)=\"editValue = false; onchange.emit();\"\n        [(ngModel)]='node.value'>\n</span>\n<span *ngIf='!editValue && (node.type === 2 || node.type === 1) && node.value!=null'\n    class='locked'\n    [class.name]=\"node.type === 4\"\n    tabindex='0'\n    (keydown)='valueLabelKeydown($event)'\n    (click)=\"clickValue($event)\"\n    [innerHTML]=\"node.value.length ? node.value : '&nbsp;'\">\n</span>\n",styles:[":host{margin:10px 0}span.locked{display:inline-block;cursor:pointer;min-width:30px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}span.locked.name{font-weight:700;color:#000}span input{cursor:beam}"]}]}],u.ctorParameters=function(){return[{type:n.Renderer}]},u.propDecorators={nameEditor:[{type:n.ViewChild,args:["nameEditor"]}],valueEditor:[{type:n.ViewChild,args:["valueEditor"]}],node:[{type:n.Input}],onchange:[{type:n.Output,args:["onchange"]}]};var h=function(){function e(e){this.manager=e}return e.prototype.isBlank=function(e){return e===undefined||null===e},e.prototype.transform=function(e){var n=this.manager.getFilteredText();return this.isBlank(n)?e:e.filter(function(e){return-1<e.text.indexOf(n)})},e}();h.decorators=[{type:n.Pipe,args:[{name:"nodeSearch",pure:!1}]}],h.ctorParameters=function(){return[{type:c}]};var f=function(){};f.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule,o.DragDropModule,t.FormsModule],declarations:[s,u,h,p],exports:[s],entryComponents:[],providers:[h,c],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]}]}],f.ctorParameters=function(){return[]},e.FreeJsonComponent=s,e.NodeType=l,e.ActionType=d,e.FreeJsonModule=f,e.ɵb=u,e.ɵd=p,e.ɵa=c,e.ɵc=h,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=free-json.umd.min.js.map

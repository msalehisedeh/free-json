!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/forms"),require("@angular/common"),require("@sedeh/drag-enabled")):"function"==typeof define&&define.amd?define("@sedeh/free-json",["exports","@angular/core","@angular/forms","@angular/common","@sedeh/drag-enabled"],n):n(((e=e||self).sedeh=e.sedeh||{},e.sedeh["free-json"]={}),e.ng.core,e.ng.forms,e.ng.common,e["drag-enabled"])}(this,(function(e,n,t,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var a,i;function d(e,n,t,r){var o,a=arguments.length,i=a<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,t,r);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(i=(a<3?o(i):a>3?o(n,t,i):o(n,t))||i);return a>3&&i&&Object.defineProperty(n,t,i),i}function l(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i}function c(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(l(arguments[n]));return e}(a=e.NodeType||(e.NodeType={}))[a.literal=1]="literal",a[a.pair=2]="pair",a[a.json=3]="json",a[a.array=4]="array",(i=e.ActionType||(e.ActionType={}))[i.add=1]="add",i[i.remove=2]="remove",i[i.move=3]="move",i[i.modified=4]="modified";var s=function(){function t(){}return t.prototype.generateNodeId=function(){return Math.floor(1e4*Math.random())+1},t.prototype.getFilteredText=function(){return this.filteredText},t.prototype.getNewNode=function(n){return{id:this.generateNodeId(),name:"name",value:"value",parent:n.type,parentNode:n,type:e.NodeType.literal,children:[],expanded:!1}},t.prototype.setFilteredText=function(e){this.filteredText=e},t=d([n.Injectable()],t)}(),p=function(){function t(e){this.manager=e,this.reasoningCodes=[],this.onpublish=new n.EventEmitter,this.onchange=new n.EventEmitter}return Object.defineProperty(t.prototype,"root",{get:function(){return this.children},set:function(n){if(n){this.children=n,this.reasoning&&(this.reasoning=[]);var t={id:this.manager.generateNodeId(),name:"Root",value:"Object",parent:e.NodeType.array,type:e.NodeType.array,expanded:!0,children:void 0,isRoot:!0};t.children=this.transformNodeToInternalStruction(this.children,t),this.transformedData=[t]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"save",{get:function(){return!1},set:function(n){if(n){var t=this.transformedInternalStructureBackToNode(this.transformedData[0].children,e.NodeType.json);this.onpublish.emit(t)}},enumerable:!0,configurable:!0}),t.prototype.transformedInternalStructureBackToNode=function(n,t){var r=this,o={},a=[];return n.map((function(n){t===e.NodeType.json?n.type===e.NodeType.literal?a.push(n.value):n.type===e.NodeType.pair?o[n.name]=n.value:n.type===e.NodeType.array?o[n.name]=r.transformedInternalStructureBackToNode(n.children,n.parent):n.type===e.NodeType.json&&(o[n.name]=r.transformedInternalStructureBackToNode(n.children,n.parent)):t===e.NodeType.array&&(n.type===e.NodeType.literal?a.push(n.value):n.type===e.NodeType.json?a.push(r.transformedInternalStructureBackToNode(n,n.parent)):n.type===e.NodeType.array&&a.push(r.transformedInternalStructureBackToNode(n.children,n.parent)))})),a.length?a:o},t.prototype.transformNodeToInternalStruction=function(n,t){var r=this,o=n;if(n instanceof Array){var a=[];n.map((function(n){var o={id:r.manager.generateNodeId(),name:"",value:"",parent:e.NodeType.array,parentNode:t,type:e.NodeType.array,children:[]},i=r.transformNodeToInternalStruction(n,o);i instanceof Array?(o.children=i,a.push(o)):(o.value=i,o.type=e.NodeType.literal,a.push(o))})),o=a}else if(n instanceof Object){var i=Object.keys(n),d=[];i.map((function(o){var a={id:r.manager.generateNodeId(),name:o,value:"",parent:e.NodeType.json,parentNode:t,type:e.NodeType.array,children:[]},i=r.transformNodeToInternalStruction(n[o],a);i instanceof Array?(a.children=i,d.push(a)):(a.value=i,a.type=e.NodeType.pair,d.push(a))})),o=d}return o},t.prototype.ngOnInit=function(){},t.prototype.addNewNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(n.children=c(n.children,[this.manager.getNewNode(n)]),n.expanded=!0,this.changePerformed({}))},t.prototype.moveNode=function(e,n,t){if(e.stopPropagation(),e.preventDefault(),this.reasoning);else{var r=this.transformedData.indexOf(n),o=t?r>0?r-1:r:r<this.transformedData.length-1?r+1:r;this.transformedData.splice(o,0,this.transformedData.splice(r,1)[0]),this.changePerformed({})}},t.prototype.deleteNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(this.transformedData.splice(this.transformedData.indexOf(n),1),this.changePerformed({}))},t.prototype.hasChevronDown=function(e){return e&&e.children&&e.children.length>0&&e.expanded},t.prototype.hasChevronRight=function(e){return e&&e.children&&0!=e.children.length&&!e.expanded},t.prototype.dragEnabled=function(e){return!e.medium.isRoot&&(e.medium.name.length||e.medium.value.length)},t.prototype.dropEnabled=function(e){return!e.destination.medium.isRoot},t.prototype.onDragStart=function(e){},t.prototype.onDragEnd=function(e){if(e.destination&&e.source.medium!==e.destination.medium){var n=this.transformedData.indexOf(e.source.medium);this.reasoning?console.log("adsadas"):(this.transformedData.splice(n,1),this.changePerformed({}))}},t.prototype.onDrop=function(n){if(n.destination&&n.source&&n.source.medium!==n.destination.medium){var t=n.source.medium,r=n.destination.medium;r.children=c(r.children,[t]),r.children.length&&(r.expanded=!0),r.type===e.NodeType.literal?(r.type=e.NodeType.json,r.value=""):r.type===e.NodeType.pair?r.type=e.NodeType.json:r.type===e.NodeType.array&&r.parent===e.NodeType.array&&t.type===e.NodeType.pair&&(t.type=e.NodeType.json),t.parent=r.type;var o=t.parentNode.children.indexOf(t);t.parentNode.children.splice(o,1),t.parentNode=r,this.changePerformed({})}},t.prototype.toGrandParent=function(n,t){n.stopPropagation(),n.preventDefault();var r=t.parentNode,o=t.parentNode.parentNode,a=r.children.indexOf(t),i=o.children.indexOf(r);r.children.splice(a,1),0===r.children.length?r.name.length||r.value.length?(r.type=e.NodeType.pair,o.children.splice(i+1,0,t)):(o.children.splice(i,1),o.children.splice(i,0,t)):o.children.splice(i+1,0,t),t.parentNode=o,this.changePerformed({})},t.prototype.getFilteredText=function(){this.manager.getFilteredText()},t.prototype.toggle=function(e,n){e.stopPropagation(),e.preventDefault(),n.expanded=!n.expanded},t.prototype.keydown=function(e,n){var t=e.which;13!==t&&32!==t||this.toggle(e,n)},t.prototype.keymove=function(e,n,t){var r=e.which;13!==r&&32!==r||this.moveNode(e,n,t)},t.prototype.keydelete=function(e,n){var t=e.which;13!==t&&32!==t||this.deleteNode(e,n)},t.prototype.keytoGrandParent=function(e,n){var t=e.which;13!==t&&32!==t||this.toGrandParent(e,n)},t.prototype.keyadd=function(e,n){var t=e.which;13!==t&&32!==t||this.addNewNode(e,n)},t.prototype.canAddNode=function(n){return n.type===e.NodeType.json||n.type===e.NodeType.array},t.prototype.changePerformed=function(n){if(this.children){var t=this.transformedInternalStructureBackToNode(this.transformedData[0].children,e.NodeType.json);this.onchange.emit({data:t,reasoning:this.reasoning})}else this.onchange.emit({})},t.ctorParameters=function(){return[{type:s}]},d([n.Input("transformedData")],t.prototype,"transformedData",void 0),d([n.Input("reasoning")],t.prototype,"reasoning",void 0),d([n.Input("reasoningCodes")],t.prototype,"reasoningCodes",void 0),d([n.Input()],t.prototype,"root",null),d([n.Input()],t.prototype,"save",null),d([n.Output("onpublish")],t.prototype,"onpublish",void 0),d([n.Output("onchange")],t.prototype,"onchange",void 0),t=d([n.Component({selector:"free-json",template:'<ul>\r\n  <li  *ngFor="let child of transformedData | nodeSearch"\r\n        [dragEnabled]="dragEnabled.bind(this)"\r\n        [medium]="child"\r\n        (onDragEnd)=\'onDragEnd($event)\'\r\n        (onDragStart)=\'onDragStart($event)\'>\r\n    <div [dropEnabled]="dropEnabled.bind(this)" \r\n        class=\'tree-node\'\r\n        [id] = "child.id"\r\n        [medium]="child"\r\n        [class.move]="!child.isRoot && (child.name.length || child.value.length)"\r\n        (click)="toggle($event, child)"\r\n        (onDrop)=\'onDrop($event)\'>\r\n      <i  class=\'clickable fa fa-chevron-down\' \r\n          tabindex="0"\r\n          title="Collapse {{child.name}}"\r\n          *ngIf=\'hasChevronDown(child)\' \r\n          (keydown)=\'keydown($event, child)\'\r\n          (click)=\'toggle($event, child)\'></i>\r\n      <i  class=\'clickable fa fa-chevron-right\' \r\n          tabindex="0"\r\n          title="Expand {{child.name}}"\r\n          *ngIf=\'hasChevronRight(child)\' \r\n          (keydown)=\'keydown($event, child)\'\r\n          (click)=\'toggle($event, child)\'></i>\r\n      <i  class=\'fa fa-quote-right\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 1\'></i>\r\n          <i  class=\'fa fa-random\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 2\'></i>\r\n      <i  class=\'fa no-action fa-chevron-right\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 4 && child.children.length == 0\'></i>\r\n      <json-label \r\n            (onchange)="changePerformed($event)"\r\n            [node]="child"></json-label>\r\n      <span class="edit-actions">\r\n      <i *ngIf="!child.isRoot"\r\n          class="clickable fa pull-right fa-times" \r\n          tabindex="0"\r\n          title="Delete {{child.name}}"\r\n          (click)=\'deleteNode($event, child)\' \r\n          (keydown)=\'keydelete($event, child)\'></i>\r\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\r\n          class="clickable fa pull-right fa-angle-double-up" \r\n          tabindex="0"\r\n          title="Move up {{child.name}}"\r\n          (click)=\'moveNode($event, child, true)\' \r\n          (keydown)=\'keymove($event, child, true)\'></i>\r\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\r\n          class="clickable fa pull-right fa-angle-double-down" \r\n          tabindex="0"\r\n          title="Move down {{child.name}}"\r\n          (click)=\'moveNode($event, child, false)\' \r\n          (keydown)=\'keymove($event, child, false)\'></i>\r\n      <i *ngIf="canAddNode(child)"\r\n          class="clickable fa pull-right fa-plus" \r\n          tabindex="0"\r\n          title="Add New Child"\r\n          (keydown)=\'keyadd($event, child)\'\r\n          (click)=\'addNewNode($event, child)\'></i>\r\n      <i *ngIf="!child.isRoot && child.parentNode.parentNode && (child.name.length || child.value.length)"\r\n          class="clickable fa pull-right fa-angle-double-left" \r\n          tabindex="0"\r\n          title="Move to {{child.parentNode.parentNode.name}}"\r\n          (click)=\'toGrandParent($event, child)\' \r\n          (keydown)=\'keytoGrandParent($event, child)\'></i>\r\n      </span>\r\n    </div>\r\n    <div *ngIf="child.expanded">\r\n      <free-json \r\n            (onchange)="changePerformed($event)"\r\n            [reasoning]="reasoning"\r\n            [reasoningCodes]="reasoningCodes"\r\n            [transformedData]=\'child.children\'></free-json>\r\n    </div>\r\n  </li>\r\n</ul>\r\n\r\n',styles:["ul{list-style:none;min-width:400px}.tree-node{padding:0;border:1px solid #eef1f4;background:#f7f9ff;color:#7c9eb2;margin:3px 0;text-transform:capitalize;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.tree-node i{width:15px;height:15px;margin:10px 3px}.tree-node.move{cursor:move}.clickable{cursor:pointer}.no-action{color:transparent}.edit-actions{border-left:1px solid #eef1f4;float:right}.drag-over{background-color:#7c9eb2;color:#fff}.fa{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fa-plus-square{color:green}.fa-minus-circle{color:red}"]})],t)}(),u=function(){function e(e){this.manager=e}return e.prototype.filter=function(e){this.manager.setFilteredText(e)},e.ctorParameters=function(){return[{type:s}]},d([n.Input("val")],e.prototype,"val",void 0),e=d([n.Component({selector:"json-search-field",template:"<input type='text' [(ngModel)]='val' (ngModelChange)='filter(val)'>"})],e)}(),h=function(){function e(e){this.renderer=e,this.editName=!1,this.editValue=!1,this.onchange=new n.EventEmitter}return e.prototype.nameLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout((function(){n.nameEditor&&n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")}),66)):27===t&&(this.editName=!1)},e.prototype.valueLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout((function(){n.valueEditor&&n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")}),66)):27===t&&(this.editValue=!1)},e.prototype.clickName=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editName="Root"!==this.node.name,setTimeout((function(){n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")}),66)},e.prototype.clickValue=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editValue="Object"!==this.node.value,setTimeout((function(){n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")}),66)},e.ctorParameters=function(){return[{type:n.Renderer}]},d([n.ViewChild("nameEditor",{static:!1})],e.prototype,"nameEditor",void 0),d([n.ViewChild("valueEditor",{static:!1})],e.prototype,"valueEditor",void 0),d([n.Input()],e.prototype,"node",void 0),d([n.Output("onchange")],e.prototype,"onchange",void 0),e=d([n.Component({selector:"json-label",template:"<span *ngIf=\"editName && node.name !=='Root' && node.value !=='Object'\">\r\n    <input #nameEditor\r\n        type='text' \r\n        id=\"editName\"\r\n        placeholder=\"Name\"\r\n        (blur)=\"editName = false; onchange.emit();\" \r\n        [(ngModel)]='node.name'>\r\n</span>\r\n<span *ngIf='!editName && node.type !== 1'\r\n    class='locked name' \r\n    tabindex='0' \r\n    (keydown)='nameLabelKeydown($event)'\r\n    (click)=\"clickName($event)\"\r\n    [innerHTML]=\"node.name.length ? node.name : '&nbsp;'\">\r\n</span>\r\n<span *ngIf=\"editValue && node.name !=='Root' && node.value !=='Object'\">\r\n    <input #valueEditor\r\n        type='text' \r\n        id=\"editValue\"\r\n        placeholder=\"Value\"\r\n        (blur)=\"editValue = false; onchange.emit();\" \r\n        [(ngModel)]='node.value'>\r\n</span>\r\n<span *ngIf='!editValue && (node.type === 2 || node.type === 1) && node.value!=null'\r\n    class='locked' \r\n    [class.name]=\"node.type === 4\"\r\n    tabindex='0' \r\n    (keydown)='valueLabelKeydown($event)'\r\n    (click)=\"clickValue($event)\"\r\n    [innerHTML]=\"node.value.length ? node.value : '&nbsp;'\">\r\n</span>\r\n",styles:[":host{margin:10px 0}span.locked{display:inline-block;cursor:pointer;min-width:30px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}span.locked.name{font-weight:700;color:#000}span input{cursor:beam}"]})],e)}(),f=function(){function e(e){this.manager=e}return e.prototype.isBlank=function(e){return null==e},e.prototype.transform=function(e){var n=this.manager.getFilteredText();return this.isBlank(n)?e:e.filter((function(e){return e.text.indexOf(n)>-1}))},e.ctorParameters=function(){return[{type:s}]},e=d([n.Pipe({name:"nodeSearch",pure:!1})],e)}(),m=function(){function e(){}return e=d([n.NgModule({imports:[r.CommonModule,o.DragDropModule,t.FormsModule],declarations:[p,h,f,u],exports:[p],entryComponents:[],providers:[f,s],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]})],e)}();e.FreeJsonComponent=p,e.FreeJsonModule=m,e.ɵa=s,e.ɵb=h,e.ɵc=f,e.ɵd=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sedeh-free-json.umd.min.js.map
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/forms"),require("@angular/common"),require("@sedeh/drag-enabled")):"function"==typeof define&&define.amd?define("@sedeh/free-json",["exports","@angular/core","@angular/forms","@angular/common","@sedeh/drag-enabled"],n):n((e.sedeh=e.sedeh||{},e.sedeh["free-json"]={}),e.ng.core,e.ng.forms,e.ng.common,e["drag-enabled"])}(this,function(e,n,t,r,o){"use strict";function a(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||0<n--)&&!(r=a.next()).done;)i.push(r.value)}catch(d){o={error:d}}finally{try{r&&!r.done&&(t=a["return"])&&t.call(a)}finally{if(o)throw o.error}}return i}function i(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(a(arguments[n]));return e}var l={literal:1,pair:2,json:3,array:4};l[l.literal]="literal",l[l.pair]="pair",l[l.json]="json",l[l.array]="array";var d={add:1,remove:2,move:3,modified:4};d[d.add]="add",d[d.remove]="remove",d[d.move]="move",d[d.modified]="modified";var s=function(){function e(){}return e.prototype.generateNodeId=function(){return Math.floor(1e4*Math.random())+1},e.prototype.getFilteredText=function(){return this.filteredText},e.prototype.getNewNode=function(e){return{id:this.generateNodeId(),name:"name",value:"value",parent:e.type,parentNode:e,type:l.literal,children:[],expanded:!1}},e.prototype.setFilteredText=function(e){this.filteredText=e},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),c=function(){function e(e){this.manager=e,this.reasoningCodes=[],this.onpublish=new n.EventEmitter,this.onchange=new n.EventEmitter}return Object.defineProperty(e.prototype,"root",{get:function(){return this.children},set:function(e){if(e){this.children=e,this.reasoning&&(this.reasoning=[]);var n={id:this.manager.generateNodeId(),name:"Root",value:"Object",parent:l.array,type:l.array,expanded:!0,children:undefined,isRoot:!0};n.children=this.transformNodeToInternalStruction(this.children,n),this.transformedData=[n]}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"save",{get:function(){return!1},set:function(e){if(e){var n=this.transformedInternalStructureBackToNode(this.transformedData[0].children,l.json);this.onpublish.emit(n)}},enumerable:!0,configurable:!0}),e.prototype.transformedInternalStructureBackToNode=function(e,n){var t=this,r={},o=[];return e.map(function(e){n===l.json?e.type===l.literal?o.push(e.value):e.type===l.pair?r[e.name]=e.value:e.type===l.array?r[e.name]=t.transformedInternalStructureBackToNode(e.children,e.parent):e.type===l.json&&(r[e.name]=t.transformedInternalStructureBackToNode(e.children,e.parent)):n===l.array&&(e.type===l.literal?o.push(e.value):e.type===l.json?o.push(t.transformedInternalStructureBackToNode(e,e.parent)):e.type===l.array&&o.push(t.transformedInternalStructureBackToNode(e.children,e.parent)))}),o.length?o:r},e.prototype.transformNodeToInternalStruction=function(r,o){var a=this,e=r;if(r instanceof Array){var i=[];r.map(function(e){var n={id:a.manager.generateNodeId(),name:"",value:"",parent:l.array,parentNode:o,type:l.array,children:[]},t=a.transformNodeToInternalStruction(e,n);t instanceof Array?n.children=t:(n.value=t,n.type=l.literal),i.push(n)}),e=i}else if(r instanceof Object){var n=Object.keys(r),d=[];n.map(function(e){var n={id:a.manager.generateNodeId(),name:e,value:"",parent:l.json,parentNode:o,type:l.array,children:[]},t=a.transformNodeToInternalStruction(r[e],n);t instanceof Array?n.children=t:(n.value=t,n.type=l.pair),d.push(n)}),e=d}return e},e.prototype.ngOnInit=function(){},e.prototype.addNewNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(n.children=i(n.children,[this.manager.getNewNode(n)]),n.expanded=!0,this.changePerformed({}))},e.prototype.moveNode=function(e,n,t){if(e.stopPropagation(),e.preventDefault(),this.reasoning);else{var r=this.transformedData.indexOf(n),o=t?0<r?r-1:r:r<this.transformedData.length-1?r+1:r;this.transformedData.splice(o,0,this.transformedData.splice(r,1)[0]),this.changePerformed({})}},e.prototype.deleteNode=function(e,n){e.stopPropagation(),e.preventDefault(),this.reasoning||(this.transformedData.splice(this.transformedData.indexOf(n),1),this.changePerformed({}))},e.prototype.hasChevronDown=function(e){return e&&e.children&&0<e.children.length&&e.expanded},e.prototype.hasChevronRight=function(e){return e&&e.children&&0!=e.children.length&&!e.expanded},e.prototype.dragEnabled=function(e){return!e.medium.isRoot&&(e.medium.name.length||e.medium.value.length)},e.prototype.dropEnabled=function(e){return!e.destination.medium.isRoot},e.prototype.onDragStart=function(e){},e.prototype.onDragEnd=function(e){if(e.destination&&e.source.medium!==e.destination.medium){var n=this.transformedData.indexOf(e.source.medium);this.reasoning?console.log("adsadas"):(this.transformedData.splice(n,1),this.changePerformed({}))}},e.prototype.onDrop=function(e){if(e.destination&&e.source&&e.source.medium!==e.destination.medium){var n=e.source.medium,t=e.destination.medium;t.children=i(t.children,[n]),t.children.length&&(t.expanded=!0),t.type===l.literal?(t.type=l.json,t.value=""):t.type===l.pair?t.type=l.json:t.type===l.array&&t.parent===l.array&&n.type===l.pair&&(n.type=l.json),n.parent=t.type;var r=n.parentNode.children.indexOf(n);n.parentNode.children.splice(r,1),n.parentNode=t,this.changePerformed({})}},e.prototype.toGrandParent=function(e,n){e.stopPropagation(),e.preventDefault();var t=n.parentNode,r=n.parentNode.parentNode,o=t.children.indexOf(n),a=r.children.indexOf(t);t.children.splice(o,1),0===t.children.length?t.name.length||t.value.length?(t.type=l.pair,r.children.splice(a+1,0,n)):(r.children.splice(a,1),r.children.splice(a,0,n)):r.children.splice(a+1,0,n),n.parentNode=r,this.changePerformed({})},e.prototype.getFilteredText=function(){this.manager.getFilteredText()},e.prototype.toggle=function(e,n){e.stopPropagation(),e.preventDefault(),n.expanded=!n.expanded},e.prototype.keydown=function(e,n){var t=e.which;13!==t&&32!==t||this.toggle(e,n)},e.prototype.keymove=function(e,n,t){var r=e.which;13!==r&&32!==r||this.moveNode(e,n,t)},e.prototype.keydelete=function(e,n){var t=e.which;13!==t&&32!==t||this.deleteNode(e,n)},e.prototype.keytoGrandParent=function(e,n){var t=e.which;13!==t&&32!==t||this.toGrandParent(e,n)},e.prototype.keyadd=function(e,n){var t=e.which;13!==t&&32!==t||this.addNewNode(e,n)},e.prototype.canAddNode=function(e){return e.type===l.json||e.type===l.array},e.prototype.changePerformed=function(e){if(this.children){var n=this.transformedInternalStructureBackToNode(this.transformedData[0].children,l.json);this.onchange.emit({data:n,reasoning:this.reasoning})}else this.onchange.emit({})},e.decorators=[{type:n.Component,args:[{selector:"free-json",template:'<ul>\r\n  <li  *ngFor="let child of transformedData | nodeSearch"\r\n        [dragEnabled]="dragEnabled.bind(this)"\r\n        [medium]="child"\r\n        (onDragEnd)=\'onDragEnd($event)\'\r\n        (onDragStart)=\'onDragStart($event)\'>\r\n    <div [dropEnabled]="dropEnabled.bind(this)" \r\n        class=\'tree-node\'\r\n        [id] = "child.id"\r\n        [medium]="child"\r\n        [class.move]="!child.isRoot && (child.name.length || child.value.length)"\r\n        (click)="toggle($event, child)"\r\n        (onDrop)=\'onDrop($event)\'>\r\n      <i  class=\'clickable fa fa-chevron-down\' \r\n          tabindex="0"\r\n          title="Collapse {{child.name}}"\r\n          *ngIf=\'hasChevronDown(child)\' \r\n          (keydown)=\'keydown($event, child)\'\r\n          (click)=\'toggle($event, child)\'></i>\r\n      <i  class=\'clickable fa fa-chevron-right\' \r\n          tabindex="0"\r\n          title="Expand {{child.name}}"\r\n          *ngIf=\'hasChevronRight(child)\' \r\n          (keydown)=\'keydown($event, child)\'\r\n          (click)=\'toggle($event, child)\'></i>\r\n      <i  class=\'fa fa-quote-right\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 1\'></i>\r\n          <i  class=\'fa fa-random\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 2\'></i>\r\n      <i  class=\'fa no-action fa-chevron-right\' \r\n          arria-hidden="true"\r\n          *ngIf=\'child.type === 4 && child.children.length == 0\'></i>\r\n      <json-label \r\n            (onchange)="changePerformed($event)"\r\n            [node]="child"></json-label>\r\n      <span class="edit-actions">\r\n      <i *ngIf="!child.isRoot"\r\n          class="clickable fa pull-right fa-times" \r\n          tabindex="0"\r\n          title="Delete {{child.name}}"\r\n          (click)=\'deleteNode($event, child)\' \r\n          (keydown)=\'keydelete($event, child)\'></i>\r\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\r\n          class="clickable fa pull-right fa-angle-double-up" \r\n          tabindex="0"\r\n          title="Move up {{child.name}}"\r\n          (click)=\'moveNode($event, child, true)\' \r\n          (keydown)=\'keymove($event, child, true)\'></i>\r\n      <i *ngIf="transformedData.length > 1 && !child.isRoot"\r\n          class="clickable fa pull-right fa-angle-double-down" \r\n          tabindex="0"\r\n          title="Move down {{child.name}}"\r\n          (click)=\'moveNode($event, child, false)\' \r\n          (keydown)=\'keymove($event, child, false)\'></i>\r\n      <i *ngIf="canAddNode(child)"\r\n          class="clickable fa pull-right fa-plus" \r\n          tabindex="0"\r\n          title="Add New Child"\r\n          (keydown)=\'keyadd($event, child)\'\r\n          (click)=\'addNewNode($event, child)\'></i>\r\n      <i *ngIf="!child.isRoot && child.parentNode.parentNode && (child.name.length || child.value.length)"\r\n          class="clickable fa pull-right fa-angle-double-left" \r\n          tabindex="0"\r\n          title="Move to {{child.parentNode.parentNode.name}}"\r\n          (click)=\'toGrandParent($event, child)\' \r\n          (keydown)=\'keytoGrandParent($event, child)\'></i>\r\n      </span>\r\n    </div>\r\n    <div *ngIf="child.expanded">\r\n      <free-json \r\n            (onchange)="changePerformed($event)"\r\n            [reasoning]="reasoning"\r\n            [reasoningCodes]="reasoningCodes"\r\n            [transformedData]=\'child.children\'></free-json>\r\n    </div>\r\n  </li>\r\n</ul>\r\n\r\n',styles:["ul{list-style:none;min-width:400px}.tree-node{padding:0;border:1px solid #eef1f4;background:#f7f9ff;color:#7c9eb2;margin:3px 0;text-transform:capitalize;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.tree-node i{width:15px;height:15px;margin:10px 3px}.tree-node.move{cursor:move}.clickable{cursor:pointer}.no-action{color:transparent}.edit-actions{border-left:1px solid #eef1f4;float:right}.drag-over{background-color:#7c9eb2;color:#fff}.fa{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fa-plus-square{color:green}.fa-minus-circle{color:red}"]}]}],e.ctorParameters=function(){return[{type:s}]},e.propDecorators={transformedData:[{type:n.Input,args:["transformedData"]}],reasoning:[{type:n.Input,args:["reasoning"]}],reasoningCodes:[{type:n.Input,args:["reasoningCodes"]}],root:[{type:n.Input}],save:[{type:n.Input}],onpublish:[{type:n.Output,args:["onpublish"]}],onchange:[{type:n.Output,args:["onchange"]}]},e}(),p=function(){function e(e){this.manager=e}return e.prototype.filter=function(e){this.manager.setFilteredText(e)},e.decorators=[{type:n.Component,args:[{selector:"json-search-field",template:"<input type='text' [(ngModel)]='val' (ngModelChange)='filter(val)'>"}]}],e.ctorParameters=function(){return[{type:s}]},e.propDecorators={val:[{type:n.Input,args:["val"]}]},e}(),u=function(){function e(e){this.renderer=e,this.editName=!1,this.editValue=!1,this.onchange=new n.EventEmitter}return e.prototype.nameLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout(function(){n.nameEditor&&n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")},66)):27===t&&(this.editName=!1)},e.prototype.valueLabelKeydown=function(e){var n=this,t=e.which;13===t||32===t?(this.renderer.invokeElementMethod(e.target,"click"),setTimeout(function(){n.valueEditor&&n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")},66)):27===t&&(this.editValue=!1)},e.prototype.clickName=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editName="Root"!==this.node.name,setTimeout(function(){n.renderer.invokeElementMethod(n.nameEditor.nativeElement,"focus")},66)},e.prototype.clickValue=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this.editValue="Object"!==this.node.value,setTimeout(function(){n.renderer.invokeElementMethod(n.valueEditor.nativeElement,"focus")},66)},e.decorators=[{type:n.Component,args:[{selector:"json-label",template:"<span *ngIf=\"editName && node.name !=='Root' && node.value !=='Object'\">\r\n    <input #nameEditor\r\n        type='text' \r\n        id=\"editName\"\r\n        placeholder=\"Name\"\r\n        (blur)=\"editName = false; onchange.emit();\" \r\n        [(ngModel)]='node.name'>\r\n</span>\r\n<span *ngIf='!editName && node.type !== 1'\r\n    class='locked name' \r\n    tabindex='0' \r\n    (keydown)='nameLabelKeydown($event)'\r\n    (click)=\"clickName($event)\"\r\n    [innerHTML]=\"node.name.length ? node.name : '&nbsp;'\">\r\n</span>\r\n<span *ngIf=\"editValue && node.name !=='Root' && node.value !=='Object'\">\r\n    <input #valueEditor\r\n        type='text' \r\n        id=\"editValue\"\r\n        placeholder=\"Value\"\r\n        (blur)=\"editValue = false; onchange.emit();\" \r\n        [(ngModel)]='node.value'>\r\n</span>\r\n<span *ngIf='!editValue && (node.type === 2 || node.type === 1) && node.value!=null'\r\n    class='locked' \r\n    [class.name]=\"node.type === 4\"\r\n    tabindex='0' \r\n    (keydown)='valueLabelKeydown($event)'\r\n    (click)=\"clickValue($event)\"\r\n    [innerHTML]=\"node.value.length ? node.value : '&nbsp;'\">\r\n</span>\r\n",styles:[":host{margin:10px 0}span.locked{display:inline-block;cursor:pointer;min-width:30px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}span.locked.name{font-weight:700;color:#000}span input{cursor:beam}"]}]}],e.ctorParameters=function(){return[{type:n.Renderer}]},e.propDecorators={nameEditor:[{type:n.ViewChild,args:["nameEditor"]}],valueEditor:[{type:n.ViewChild,args:["valueEditor"]}],node:[{type:n.Input}],onchange:[{type:n.Output,args:["onchange"]}]},e}(),h=function(){function e(e){this.manager=e}return e.prototype.isBlank=function(e){return e===undefined||null===e},e.prototype.transform=function(e){var n=this.manager.getFilteredText();return this.isBlank(n)?e:e.filter(function(e){return-1<e.text.indexOf(n)})},e.decorators=[{type:n.Pipe,args:[{name:"nodeSearch",pure:!1}]}],e.ctorParameters=function(){return[{type:s}]},e}(),f=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule,o.DragDropModule,t.FormsModule],declarations:[c,u,h,p],exports:[c],entryComponents:[],providers:[h,s],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]}]}],e}();e.FreeJsonComponent=c,e.NodeType=l,e.ActionType=d,e.FreeJsonModule=f,e.ɵb=u,e.ɵd=p,e.ɵa=s,e.ɵc=h,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sedeh-free-json.umd.min.js.map